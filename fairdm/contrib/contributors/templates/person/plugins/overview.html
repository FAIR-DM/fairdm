{% extends "plugins/overview.html" %}
{% load fairdm humanize i18n martortags static easy_icons %}

{% block page_content_header %}
  <c-card.page-header title="{{ object }}">
    <c-slot name="subtitle">
      <c-icon name="organization" />
      {% with object.primary_affiliation.organization as org %}
        <c-link href="{{ org.get_absolute_url }}"
                subtle
                variant="secondary">
          {{ org }}
        </c-link>
      {% endwith %}
    </c-slot>
    <c-slot name="extra_title">
      <p class="card-text text-muted">
        <c-icon name="location" />
        {{ object.get_location_display }}
      </p>
    </c-slot>
    <c-slot name="content_left">
      <c-person-card>
        <c-slot name="footer">
          {% if object.is_active %}
            <span class="text-muted"><strong>{% trans "Member Since" %}:</strong> {{ object.date_joined|date:"M, Y" }}</span>
          {% endif %}
        </c-slot>
      </c-person-card>
    </c-slot>
    <c-slot name="info_boxes">
      <c-widgets.type-a label="{% trans "Projects" %}"
                        icon="project"
                        :number="object.projects.count"
                        variant="primary" />
      <div class="vr mx-3"></div>
      <c-widgets.type-a label="{% trans "Datasets" %}"
                        icon="dataset"
                        :value="object.datasets.count"
                        variant="success" />
      <div class="vr mx-3"></div>
      <c-widgets.type-a label="{% trans "Followers" %}"
                        icon="people"
                        :value="object.datasets.count"
                        variant="warning" />
    </c-slot>
    <div class="card-footer bg-body">
      <div class="d-flex justify-content-around">
        <c-action class="btn-link text-decoration-none"
                  icon="add"
                  text="{% trans "Follow" %}" />
        <c-action class="btn-link text-decoration-none"
                  icon="email"
                  text="{% trans "Contact" %}" />
        <c-action class="btn-link text-decoration-none"
                  icon="share"
                  text="{% trans "Share" %}" />
      </div>
    </div>
  </c-card.page-header>
{% endblock page_content_header %}

{% block page_content %}
  <c-card title="{% trans "About" %}"
          icon="file_text"
          edit_url="{% if object == request.user %}{% plugin_url "profile" %}{% endif %}">
    {% if object.profile %}
      <p class="card-text">{{ object.profile|safe_markdown }}</p>
    {% else %}
      <p class="text-muted">{{ empty_text }}</p>
    {% endif %}
  </c-card>
{% endblock page_content %}

{# Sidebar #}
{% block page_sidebar %}
  <c-card title="{% trans "Affiliations" %}"
          icon="organization"
          edit_url="{% if object == request.user %}{% plugin_url 'affiliations' %}{% endif %}">
    <c-list-group flush>
      {% for membership in object.current_affiliations %}
        <c-list-group.item>
          <div class="d-flex w-100 justify-content-between align-items-start">
            <div>
              <h6 class="mb-1">
                {% if membership.organization.get_absolute_url %}
                  <a href="{{ membership.organization.get_absolute_url }}"
                     class="text-decoration-none">{{ membership.organization.name }}</a>
                {% else %}
                  {{ membership.organization.name }}
                {% endif %}
              </h6>
              {% if membership.is_primary %}
                <small class="text-muted">
                  <c-badge variant="primary"
                           size="sm"
                           :text="{% trans "Primary" %}" />
                </small>
              {% endif %}
            </div>
          </div>
        </c-list-group.item>
      {% empty %}
        {{ empty_text }}
      {% endfor %}
    </c-list-group>
  </c-card>
  <c-card title="{% trans "Identifiers" %}"
          icon="identifier"
          edit_url="{% if object == request.user %}{% plugin_url "identifiers" %}{% endif %}">
    <dl class="mb-0">
      {% for identifier in object.identifiers.all %}
        {% comment %} <c-detail.info-item label="{{ identifier.type }}">
                  {% if identifier.get_absolute_url %}
                    <a href="{{ identifier.get_absolute_url }}" target="_blank" rel="noopener noreferrer" class="text-decoration-none">
                      {{ identifier.value }}
                      <c-icon name="external_link" size="12" class="ms-1" />
                    </a>
                  {% else %}
                    {{ identifier.value }}
                  {% endif %}
        </c-detail.info-item> {% endcomment %}
      {% empty %}
        <p class="text-muted small mb-0">{{ empty_text }}</p>
      {% endfor %}
    </dl>
  </c-card>
  <c-card title="{% trans "Links" %}" icon="link">
    {% if object.links %}
      <div class="d-flex flex-column gap-2">
        {% for link in object.links %}
          <a href="{{ link }}"
             target="_blank"
             rel="noopener noreferrer"
             class="text-decoration-none text-truncate">
            <c-icon name="external_link" size="14" class="me-1" />
            {{ link }}
          </a>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted small mb-0">{{ empty_text }}</p>
    {% endif %}
  </c-card>
  <c-card title="{% trans "Research Interests" %}"
          icon="keywords"
          edit_url="{% if object == request.user %}{% plugin_url "keywords" %}{% endif %}">
    <div class="d-flex flex-wrap gap-2">
      {% for keyword in object.keywords.all %}
        <c-badge variant="light"
                 class="text-dark border"
                 :text="keyword" />
      {% empty %}
        {{ empty_text }}
      {% endfor %}
    </div>
  </c-card>
  {# Alternative Names #}
  {% if object.alternative_names %}
    <c-card title="{% trans "Also Known As" %}"
            icon="person-badge">
      <div class="d-flex flex-wrap gap-2">
        {% for alt_name in object.alternative_names %}
          <c-badge variant="light"
                   class="text-dark border"
                   :text="alt_name" />
        {% endfor %}
      </div>
    </c-card>
  {% endif %}
  {# Account Status (only visible to the person themselves) #}
  {% if object == request.user %}
    <c-card title="{% trans "Account Status" %}"
            icon="shield-check">
      <dl class="mb-0">
        {% comment %} <c-detail.info-item label="{% trans "Account Type" %}">
                  {% if object.is_staff %}
                    <c-badge variant="danger" :text="{% trans "Staff" %}" />
                  {% elif object.is_active %}
                    <c-badge variant="success" :text="{% trans "Active" %}" />
                  {% else %}
                    <c-badge variant="secondary" :text="{% trans "Inactive" %}" />
                  {% endif %}
                </c-detail.info-item>
                <c-detail.info-item label="{% trans "Member Since" %}" text="{{ object.date_joined|date:'F Y' }}" />
                {% if object.last_login %}
                  <c-detail.info-item label="{% trans "Last Login" %}" text="{{ object.last_login|naturaltime }}" />
        {% endif %} {% endcomment %}
      </dl>
    </c-card>
  {% endif %}
  {% block sync_info %}
    {# Sync Information (only visible to the person themselves) #}
    {% if object == request.user and object.last_synced %}
      <c-card title="{% trans "Data Synchronization" %}"
              icon="arrow-repeat">
        <dl class="mb-0">
          <c-detail.info-item label="{% trans "Last Synced" %}"
                              text="{{ object.last_synced|date:'F d, Y' }}" />
        </dl>
        <div class="mt-2">
          <small class="text-muted">
            <c-icon name="info" size="14" class="me-1" />
            {% trans "Profile data synchronized from external sources." %}
          </small>
        </div>
      </c-card>
    {% endif %}
  {% endblock sync_info %}
{% endblock page_sidebar %}
