# Generated by Django 5.2.10 on 2026-02-09 14:33

import auto_prefetch
import django.db.models.deletion
import django.db.models.manager
import django_lifecycle.mixins
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("dataset", "0007_add_unique_type_constraints"),
        ("literature", "0004_alter_literatureitem_options"),
        ("project", "0005_add_unique_type_constraints"),
        ("research_vocabs", "0002_alter_concept_unique_together"),
    ]

    operations = [
        migrations.CreateModel(
            name="DatasetLiteratureRelation",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "added",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="The date and time this record was added to the database.",
                        verbose_name="Date added",
                    ),
                ),
                (
                    "modified",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="The date and time this record was last modified.",
                        verbose_name="Last modified",
                    ),
                ),
                (
                    "relationship_type",
                    models.CharField(
                        choices=[
                            ("IsCitedBy", "Is Cited By"),
                            ("Cites", "Cites"),
                            ("IsSupplementTo", "Is Supplement To"),
                            ("IsSupplementedBy", "Is Supplemented By"),
                            ("IsContinuedBy", "Is Continued By"),
                            ("Continues", "Continues"),
                            ("IsDescribedBy", "Is Described By"),
                            ("Describes", "Describes"),
                            ("HasMetadata", "Has Metadata"),
                            ("IsMetadataFor", "Is Metadata For"),
                            ("HasVersion", "Has Version"),
                            ("IsVersionOf", "Is Version Of"),
                            ("IsNewVersionOf", "Is New Version Of"),
                            ("IsPreviousVersionOf", "Is Previous Version Of"),
                            ("IsPartOf", "Is Part Of"),
                            ("HasPart", "Has Part"),
                            ("IsPublishedIn", "Is Published In"),
                            ("IsReferencedBy", "Is Referenced By"),
                            ("References", "References"),
                            ("IsDocumentedBy", "Is Documented By"),
                            ("Documents", "Documents"),
                            ("IsCompiledBy", "Is Compiled By"),
                            ("Compiles", "Compiles"),
                            ("IsVariantFormOf", "Is Variant Form Of"),
                            ("IsOriginalFormOf", "Is Original Form Of"),
                            ("IsIdenticalTo", "Is Identical To"),
                            ("IsReviewedBy", "Is Reviewed By"),
                            ("Reviews", "Reviews"),
                            ("IsDerivedFrom", "Is Derived From"),
                            ("IsSourceOf", "Is Source Of"),
                            ("IsRequiredBy", "Is Required By"),
                            ("Requires", "Requires"),
                            ("Obsoletes", "Obsoletes"),
                            ("IsObsoletedBy", "Is Obsoleted By"),
                        ],
                        help_text="DataCite relationship type (e.g., IsCitedBy, Cites, IsDocumentedBy)",
                        max_length=50,
                        verbose_name="relationship type",
                    ),
                ),
            ],
            options={
                "verbose_name": "dataset literature relation",
                "verbose_name_plural": "dataset literature relations",
            },
            bases=(django_lifecycle.mixins.LifecycleModelMixin, models.Model),
            managers=[
                ("objects", django.db.models.manager.Manager()),
                ("prefetch_manager", django.db.models.manager.Manager()),
            ],
        ),
        migrations.AlterModelManagers(
            name="datasetdate",
            managers=[],
        ),
        migrations.AlterModelManagers(
            name="datasetdescription",
            managers=[],
        ),
        migrations.AlterModelManagers(
            name="datasetidentifier",
            managers=[],
        ),
        migrations.AlterField(
            model_name="dataset",
            name="keywords",
            field=models.ManyToManyField(
                blank=True,
                help_text="Controlled keywords for discoverability",
                to="research_vocabs.concept",
                verbose_name="keywords",
            ),
        ),
        migrations.AlterField(
            model_name="dataset",
            name="name",
            field=models.CharField(max_length=300, verbose_name="name"),
        ),
        migrations.AlterField(
            model_name="dataset",
            name="project",
            field=auto_prefetch.ForeignKey(
                blank=True,
                help_text="The project associated with the dataset.",
                null=True,
                on_delete=django.db.models.deletion.PROTECT,
                related_name="datasets",
                to="project.project",
                verbose_name="project",
            ),
        ),
        migrations.AddIndex(
            model_name="datasetdate",
            index=models.Index(fields=["type"], name="dataset_date_type_idx"),
        ),
        migrations.AddIndex(
            model_name="datasetdescription",
            index=models.Index(fields=["type"], name="dataset_desc_type_idx"),
        ),
        migrations.AddField(
            model_name="datasetliteraturerelation",
            name="dataset",
            field=auto_prefetch.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="literature_relations",
                to="dataset.dataset",
                verbose_name="dataset",
            ),
        ),
        migrations.AddField(
            model_name="datasetliteraturerelation",
            name="literature_item",
            field=auto_prefetch.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="dataset_relations",
                to="literature.literatureitem",
                verbose_name="literature item",
            ),
        ),
        # Remove old related_literature M2M field (was ManyToManyField without through)
        migrations.RemoveField(
            model_name="dataset",
            name="related_literature",
        ),
        # Add new related_literature field with through model
        migrations.AddField(
            model_name="dataset",
            name="related_literature",
            field=models.ManyToManyField(
                blank=True,
                help_text="Any literature that is related to this dataset.",
                related_name="related_datasets",
                related_query_name="related_dataset",
                through="dataset.DatasetLiteratureRelation",
                to="literature.literatureitem",
            ),
        ),
        migrations.AddIndex(
            model_name="datasetliteraturerelation",
            index=models.Index(
                fields=["relationship_type"], name="dataset_dat_relatio_5486df_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="datasetliteraturerelation",
            unique_together={("dataset", "literature_item", "relationship_type")},
        ),
    ]
